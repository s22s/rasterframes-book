
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Creating RasterFrames &#8212; RasterFrames-Docs 0.7.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="section" id="Creating&nbsp;RasterFrames">
<h1>Creating&nbsp;RasterFrames<a class="headerlink" href="#Creating RasterFrames" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Initialization">
<h2>Initialization<a class="headerlink" href="#Initialization" title="Permalink to this headline">¶</a></h2>
<p>There are a couple of setup steps necessary anytime you want to work
with RasterFrames. the first is to import the API symbols into scope.
Next, initialize the <code class="docutils literal notranslate"><span class="pre">SparkSession</span></code>, and call the <code class="docutils literal notranslate"><span class="pre">withRasterFrames</span></code>
method on it:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">import</span> <span class="nn">astraea.spark.rasterframes._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">spark</span> <span class="k">=</span> <span class="nc">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">().</span>
  <span class="n">master</span><span class="o">(</span><span class="s">&quot;local&quot;</span><span class="o">).</span><span class="n">appName</span><span class="o">(</span><span class="s">&quot;RasterFrames&quot;</span><span class="o">).</span>
  <span class="n">config</span><span class="o">(</span><span class="s">&quot;spark.ui.enabled&quot;</span><span class="o">,</span> <span class="s">&quot;false&quot;</span><span class="o">).</span>
  <span class="n">getOrCreate</span><span class="o">().</span>
  <span class="n">withRasterFrames</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Intitializing Scala interpreter ...
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Spark Web UI available at http://172.18.0.2:4040
SparkContext available as &#39;sc&#39; (version = 2.2.0, master = local[*], app id = local-1531509407982)
SparkSession available as &#39;spark&#39;

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[1]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>import astraea.spark.rasterframes._
import org.apache.spark.sql._
spark: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@70bf7a68

</pre></div>
</div>
</div>
<p>And, as is standard Spark SQL practice, we import additional DataFrame
support:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">import</span> <span class="nn">spark.implicits._</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">setLogLevel</span><span class="o">(</span><span class="s">&quot;ERROR&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[2]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>import spark.implicits._

</pre></div>
</div>
</div>
<p>Now we are ready to create a RasterFrame.</p>
</div>
<div class="section" id="Reading-a-GeoTIFF">
<h2>Reading a GeoTIFF<a class="headerlink" href="#Reading-a-GeoTIFF" title="Permalink to this headline">¶</a></h2>
<p>The most straightforward way to create a <code class="docutils literal notranslate"><span class="pre">RasterFrame</span></code> is to read a
<a class="reference external" href="https://en.wikipedia.org/wiki/GeoTIFF">GeoTIFF</a> file using a
RasterFrame
<code class="docutils literal notranslate"><span class="pre">`DataSource</span></code> &lt;<a class="reference external" href="https://spark.apache.org/docs/latest/sql-programming-guide.html#data-sources">https://spark.apache.org/docs/latest/sql-programming-guide.html#data-sources</a>&gt;`__
designed for this purpose.</p>
<p>First add the following imports:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">import</span> <span class="nn">astraea.spark.rasterframes.datasource.geotiff._</span>
<span class="k">import</span> <span class="nn">java.io.File</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[3]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>import astraea.spark.rasterframes.datasource.geotiff._
import java.io.File

</pre></div>
</div>
</div>
<p>(This is what adds the <code class="docutils literal notranslate"><span class="pre">.geotiff</span></code> method to <code class="docutils literal notranslate"><span class="pre">spark.read</span></code> below.)</p>
<p>Then we use the <code class="docutils literal notranslate"><span class="pre">DataFrameReader</span></code> provided by <code class="docutils literal notranslate"><span class="pre">spark.read</span></code> to read
the GeoTIFF:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">val</span> <span class="n">samplePath</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">&quot;../samples/LC08_RGB_Norfolk_COG.tiff&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">tiffRF</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span>
  <span class="n">geotiff</span><span class="o">.</span>
  <span class="n">loadRF</span><span class="o">(</span><span class="n">samplePath</span><span class="o">.</span><span class="n">toURI</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[7]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>samplePath: java.io.File = ../samples/LC08_RGB_Norfolk_COG.tiff
tiffRF: astraea.spark.rasterframes.RasterFrame = [spatial_key: struct&lt;col: int, row: int&gt;, bounds: polygon ... 4 more fields]

</pre></div>
</div>
</div>
<p>Let’s inspect the structure of what we get back:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="n">tiffRF</span><span class="o">.</span><span class="n">printSchema</span><span class="o">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
root
 |-- spatial_key: struct (nullable = false)
 |    |-- col: integer (nullable = false)
 |    |-- row: integer (nullable = false)
 |-- bounds: polygon (nullable = true)
 |-- metadata: map (nullable = true)
 |    |-- key: string
 |    |-- value: string (valueContainsNull = false)
 |-- tile_1: rf_tile (nullable = false)
 |-- tile_2: rf_tile (nullable = false)
 |-- tile_3: rf_tile (nullable = false)

</pre></div></div>
</div>
<p>As reported by Spark, RasterFrames extracts 6 columns from the GeoTIFF
we selected. Some of these columns are dependent on the contents of the
source data, and some are are always available. Let’s take a look at
these in more detail.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">spatial_key</span></code>: GeoTrellis assigns a <code class="docutils literal notranslate"><span class="pre">SpatialKey</span></code> or a
<code class="docutils literal notranslate"><span class="pre">SpaceTimeKey</span></code> to each tile, mapping it to the layer grid from
which it came. If it has a <code class="docutils literal notranslate"><span class="pre">SpaceTimeKey</span></code>, RasterFrames will split
it into a <code class="docutils literal notranslate"><span class="pre">SpatialKey</span></code> and a <code class="docutils literal notranslate"><span class="pre">TemporalKey</span></code> (the latter with
column name <code class="docutils literal notranslate"><span class="pre">temporal_key</span></code>).</li>
<li><code class="docutils literal notranslate"><span class="pre">bounds</span></code>: The bounding box of the tile in the tile’s native CRS.</li>
<li><code class="docutils literal notranslate"><span class="pre">metadata</span></code>: The TIFF format header tags found in the file.</li>
<li><code class="docutils literal notranslate"><span class="pre">tile</span></code> or <code class="docutils literal notranslate"><span class="pre">tile_n</span></code> (where <code class="docutils literal notranslate"><span class="pre">n</span></code> is a band number): For singleband
GeoTIFF files, the <code class="docutils literal notranslate"><span class="pre">tile</span></code> column contains the cell data split into
tiles. For multiband tiles, each column with <code class="docutils literal notranslate"><span class="pre">tile_</span></code> prefix
contains each of the sources bands, in the order they were stored.</li>
</ul>
<p>See the section <cite>Inspecting a
``RasterFrame`</cite> &lt;#inspecting-a–code-rasterframe–code-&gt;`__ (below) for
more details on accessing the RasterFrame’s metadata.</p>
</div>
<div class="section" id="Reading-a-GeoTrellis-Layer">
<h2>Reading a GeoTrellis Layer<a class="headerlink" href="#Reading-a-GeoTrellis-Layer" title="Permalink to this headline">¶</a></h2>
<p>If your imagery is already ingested into a <a class="reference external" href="https://docs.geotrellis.io/en/latest/guide/spark.html#writing-layers">GeoTrellis
layer</a>,
you can use the RasterFrames GeoTrellis DataSource. There are two parts
to this GeoTrellis Layer support. The first is the GeoTrellis Catalog
DataSource, which lists the GeoTrellis layers available at a URI. The
second part is the actual RasterFrame reader for pulling a layer into a
RasterFrame.</p>
<p>Before we show how all of this works we need to have a GeoTrellis layer
to work with. We can create one with the RasterFrame we constructed
above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">import</span> <span class="nn">astraea.spark.rasterframes.datasource.geotrellis._</span>
<span class="k">import</span> <span class="nn">java.nio.file.Files</span>

<span class="k">val</span> <span class="n">base</span> <span class="k">=</span> <span class="nc">Files</span><span class="o">.</span><span class="n">createTempDirectory</span><span class="o">(</span><span class="s">&quot;rf-&quot;</span><span class="o">).</span><span class="n">toUri</span>
<span class="k">val</span> <span class="n">layer</span> <span class="k">=</span> <span class="nc">Layer</span><span class="o">(</span><span class="n">base</span><span class="o">,</span> <span class="s">&quot;sample&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
<span class="n">tiffRF</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">geotrellis</span><span class="o">.</span><span class="n">asLayer</span><span class="o">(</span><span class="n">layer</span><span class="o">).</span><span class="n">save</span><span class="o">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[9]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>import astraea.spark.rasterframes.datasource.geotrellis._
import java.nio.file.Files
base: java.net.URI = file:///tmp/rf-426423267263801253/
layer: astraea.spark.rasterframes.datasource.geotrellis.Layer = Layer(file:///tmp/rf-426423267263801253/,Layer(name = &quot;sample&quot;, zoom = 0))

</pre></div>
</div>
</div>
<p>Now we can point our catalog reader at the base directory and see what
was saved:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">val</span> <span class="n">cat</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">geotrellisCatalog</span><span class="o">(</span><span class="n">base</span><span class="o">)</span>
<span class="n">cat</span><span class="o">.</span><span class="n">printSchema</span>
<span class="n">cat</span><span class="o">.</span><span class="n">show</span><span class="o">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
root
 |-- index: integer (nullable = false)
 |-- layer: struct (nullable = true)
 |    |-- base: struct (nullable = false)
 |    |    |-- uri: string (nullable = false)
 |    |-- id: struct (nullable = false)
 |    |    |-- name: string (nullable = true)
 |    |    |-- zoom: integer (nullable = false)
 |-- format: string (nullable = true)
 |-- keyClass: string (nullable = true)
 |-- path: string (nullable = true)
 |-- valueClass: string (nullable = true)
 |-- bounds: struct (nullable = true)
 |    |-- maxKey: struct (nullable = true)
 |    |    |-- col: long (nullable = true)
 |    |    |-- row: long (nullable = true)
 |    |-- minKey: struct (nullable = true)
 |    |    |-- col: long (nullable = true)
 |    |    |-- row: long (nullable = true)
 |-- cellType: string (nullable = true)
 |-- crs: string (nullable = true)
 |-- extent: struct (nullable = true)
 |    |-- xmax: double (nullable = true)
 |    |-- xmin: double (nullable = true)
 |    |-- ymax: double (nullable = true)
 |    |-- ymin: double (nullable = true)
 |-- layoutDefinition: struct (nullable = true)
 |    |-- extent: struct (nullable = true)
 |    |    |-- xmax: double (nullable = true)
 |    |    |-- xmin: double (nullable = true)
 |    |    |-- ymax: double (nullable = true)
 |    |    |-- ymin: double (nullable = true)
 |    |-- tileLayout: struct (nullable = true)
 |    |    |-- layoutCols: long (nullable = true)
 |    |    |-- layoutRows: long (nullable = true)
 |    |    |-- tileCols: long (nullable = true)
 |    |    |-- tileRows: long (nullable = true)

+-----+--------------------+------+--------------------+--------+--------------------+-------------+--------+--------------------+--------------------+--------------------+
|index|               layer|format|            keyClass|    path|          valueClass|       bounds|cellType|                 crs|              extent|    layoutDefinition|
+-----+--------------------+------+--------------------+--------+--------------------+-------------+--------+--------------------+--------------------+--------------------+
|    0|[[file:///tmp/rf-...|  file|geotrellis.spark....|sample/0|geotrellis.raster...|[[4,3],[0,0]]|  uint16|+proj=utm +zone=1...|[395295.0,364455....|[[395295.0,364455...|
+-----+--------------------+------+--------------------+--------+--------------------+-------------+--------+--------------------+--------------------+--------------------+

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[10]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>cat: org.apache.spark.sql.DataFrame = [index: int, layer: struct&lt;base: struct&lt;uri: string&gt;, id: struct&lt;name: string, zoom: int&gt;&gt; ... 9 more fields]

</pre></div>
</div>
</div>
<p>As you can see, there’s a lot of information stored in each row of the
catalog. Most of this is associated with how the layer is discretized.
However, there may be other application specific metadata serialized
with a layer that can be use to filter the catalog entries or select a
specific one. But for now, we’re just going to load a RasterFrame in
from the catalog using a convenience function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">val</span> <span class="n">firstLayer</span> <span class="k">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">geotrellis_layer</span><span class="o">).</span><span class="n">first</span>
<span class="k">val</span> <span class="n">rfAgain</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">geotrellis</span><span class="o">.</span><span class="n">loadRF</span><span class="o">(</span><span class="n">firstLayer</span><span class="o">)</span>
<span class="n">rfAgain</span><span class="o">.</span><span class="n">show</span><span class="o">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
+-----------+--------------------+--------------------+--------------------+--------------------+
|spatial_key|              bounds|              tile_1|              tile_2|              tile_3|
+-----------+--------------------+--------------------+--------------------+--------------------+
|      [0,1]|POLYGON ((364455 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [2,0]|POLYGON ((376791 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [1,0]|POLYGON ((370623 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [0,0]|POLYGON ((364455 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [1,1]|POLYGON ((370623 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [3,0]|POLYGON ((382959 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [3,1]|POLYGON ((382959 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [1,2]|POLYGON ((370623 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [2,1]|POLYGON ((376791 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [0,2]|POLYGON ((364455 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [0,3]|POLYGON ((364455 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [1,3]|POLYGON ((370623 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [4,1]|POLYGON ((389127 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [2,2]|POLYGON ((376791 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [2,3]|POLYGON ((376791 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [3,3]|POLYGON ((382959 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [3,2]|POLYGON ((382959 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [4,0]|POLYGON ((389127 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [4,2]|POLYGON ((389127 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
|      [4,3]|POLYGON ((389127 ...|geotrellis.raster...|geotrellis.raster...|geotrellis.raster...|
+-----------+--------------------+--------------------+--------------------+--------------------+

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[11]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>firstLayer: astraea.spark.rasterframes.datasource.geotrellis.Layer = Layer(file:///tmp/rf-426423267263801253/,Layer(name = &quot;sample&quot;, zoom = 0))
rfAgain: astraea.spark.rasterframes.RasterFrame = [spatial_key: struct&lt;col: int, row: int&gt;, bounds: polygon ... 3 more fields]

</pre></div>
</div>
</div>
<p>If you already know the <code class="docutils literal notranslate"><span class="pre">LayerId</span></code> of what you’re wanting to read, you
can bypass working with the catalog:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">val</span> <span class="n">anotherRF</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">geotrellis</span><span class="o">.</span><span class="n">loadRF</span><span class="o">(</span><span class="n">layer</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[12]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>anotherRF: astraea.spark.rasterframes.RasterFrame = [spatial_key: struct&lt;col: int, row: int&gt;, bounds: polygon ... 3 more fields]

</pre></div>
</div>
</div>
</div>
<div class="section" id="Writing-a-GeoTrellis-Layer">
<h2>Writing a GeoTrellis Layer<a class="headerlink" href="#Writing-a-GeoTrellis-Layer" title="Permalink to this headline">¶</a></h2>
<p><strong>TODO</strong></p>
</div>
<div class="section" id="Using-GeoTrellis-APIs">
<h2>Using GeoTrellis APIs<a class="headerlink" href="#Using-GeoTrellis-APIs" title="Permalink to this headline">¶</a></h2>
<p>If you are used to working directly with the GeoTrellis APIs, there are
a number of additional ways to create a <code class="docutils literal notranslate"><span class="pre">RasterFrame</span></code>, as enumerated
in the sections below.</p>
<p>First, some more <code class="docutils literal notranslate"><span class="pre">import</span></code>s:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">import</span> <span class="nn">geotrellis.raster.io.geotiff.SinglebandGeoTiff</span>
<span class="k">import</span> <span class="nn">geotrellis.spark.io._</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[4]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>import geotrellis.raster.io.geotiff.SinglebandGeoTiff
import geotrellis.spark.io._

</pre></div>
</div>
</div>
<div class="section" id="From-ProjectedExtent">
<h3>From <code class="docutils literal notranslate"><span class="pre">ProjectedExtent</span></code><a class="headerlink" href="#From-ProjectedExtent" title="Permalink to this headline">¶</a></h3>
<p>The simplest mechanism for getting a RasterFrame is to use the
<code class="docutils literal notranslate"><span class="pre">toRF(tileCols,</span> <span class="pre">tileRows)</span></code> extension method on <code class="docutils literal notranslate"><span class="pre">ProjectedRaster</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">val</span> <span class="n">scene</span> <span class="k">=</span> <span class="nc">SinglebandGeoTiff</span><span class="o">(</span><span class="s">&quot;../samples/L8-B8-Robinson-IL.tiff&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">rf</span> <span class="k">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">projectedRaster</span><span class="o">.</span><span class="n">toRF</span><span class="o">(</span><span class="mi">128</span><span class="o">,</span> <span class="mi">128</span><span class="o">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">show</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="n">scene</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>res4: geotrellis.raster.io.geotiff.SinglebandGeoTiff = SinglebandGeoTiff(geotrellis.raster.UShortConstantNoDataArrayTile@1c49fd8d,Extent(431902.5, 4313647.5, 443512.5, 4321147.5),EPSG:32616,Tags(Map(AREA_OR_POINT -&gt; POINT),List(Map())),GeoTiffOptions(geotrellis.raster.io.geotiff.Striped@20fb483f,geotrellis.raster.io.geotiff.compression.DeflateCompression$@30c85a91,1,None))

</pre></div>
</div>
</div>
</div>
<div class="section" id="From-TileLayerRDD">
<h3>From <code class="docutils literal notranslate"><span class="pre">TileLayerRDD</span></code><a class="headerlink" href="#From-TileLayerRDD" title="Permalink to this headline">¶</a></h3>
<p>Another option is to use a GeoTrellis
<code class="docutils literal notranslate"><span class="pre">`LayerReader</span></code> &lt;<a class="reference external" href="https://docs.geotrellis.io/en/latest/guide/tile-backends.html">https://docs.geotrellis.io/en/latest/guide/tile-backends.html</a>&gt;`__,
to get a <code class="docutils literal notranslate"><span class="pre">TileLayerRDD</span></code> for which there’s also a <code class="docutils literal notranslate"><span class="pre">toRF</span></code> extension
method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">import</span> <span class="nn">geotrellis.spark._</span>
<span class="k">val</span> <span class="n">tiledLayer</span><span class="k">:</span> <span class="kt">TileLayerRDD</span><span class="o">[</span><span class="kt">SpatialKey</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">val</span> <span class="n">catalogPath</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;../catalog&quot;</span>
    <span class="k">val</span> <span class="n">store</span><span class="k">:</span> <span class="kt">AttributeStore</span> <span class="o">=</span> <span class="nc">FileAttributeStore</span><span class="o">(</span><span class="n">catalogPath</span><span class="o">)</span>
    <span class="k">val</span> <span class="n">reader</span> <span class="k">=</span> <span class="nc">FileLayerReader</span><span class="o">(</span><span class="n">store</span><span class="o">)</span>

<span class="k">val</span> <span class="n">rf</span> <span class="k">=</span> <span class="n">tiledLayer</span><span class="o">.</span><span class="n">toRF</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
scala.NotImplementedError: an implementation is missing
  at scala.Predef$.$qmark$qmark$qmark(Predef.scala:230)
  ... 49 elided

</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Inspecting-a-RasterFrame">
<h2>Inspecting a <code class="docutils literal notranslate"><span class="pre">RasterFrame</span></code><a class="headerlink" href="#Inspecting-a-RasterFrame" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">RasterFrame</span></code> has a number of methods providing access to metadata
about the contents of the RasterFrame.</p>
<div class="section" id="Tile-Column-Names">
<h3>Tile Column Names<a class="headerlink" href="#Tile-Column-Names" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="n">rf</span><span class="o">.</span><span class="n">tileColumns</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ArraySeq(tile)
</pre></div></div>
</div>
</div>
<div class="section" id="Spatial-Key-Column-Name">
<h3>Spatial Key Column Name<a class="headerlink" href="#Spatial-Key-Column-Name" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="n">rf</span><span class="o">.</span><span class="n">spatialKeyColumn</span><span class="o">.</span><span class="n">toString</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[19]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>res9: String = spatial_key

</pre></div>
</div>
</div>
</div>
<div class="section" id="Temporal-Key-Column">
<h3>Temporal Key Column<a class="headerlink" href="#Temporal-Key-Column" title="Permalink to this headline">¶</a></h3>
<p>Returns an <code class="docutils literal notranslate"><span class="pre">Option[Column]</span></code> since not all RasterFrames have an
explicit temporal dimension.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="n">rf</span><span class="o">.</span><span class="n">temporalKeyColumn</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[20]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>res10: Option[String] = None

</pre></div>
</div>
</div>
</div>
<div class="section" id="Tile-Layer-Metadata">
<h3>Tile Layer Metadata<a class="headerlink" href="#Tile-Layer-Metadata" title="Permalink to this headline">¶</a></h3>
<p>The Tile Layer Metadata defines how the spatial/spatiotemporal domain is
discretized into tiles, and what the key bounds are.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-scala notranslate"><div class="highlight"><pre>
<span></span><span class="k">import</span> <span class="nn">spray.json._</span>
<span class="c1">// NB: The `fold` is required because an `Either` is returned, depending on the key type.</span>
<span class="n">rf</span><span class="o">.</span><span class="n">tileLayerMetadata</span><span class="o">.</span><span class="n">fold</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">toJson</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">toJson</span><span class="o">).</span><span class="n">prettyPrint</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[21]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>import spray.json._
res11: String =
{
  &quot;extent&quot;: {
    &quot;xmin&quot;: 431902.5,
    &quot;ymin&quot;: 4313647.5,
    &quot;xmax&quot;: 443512.5,
    &quot;ymax&quot;: 4321147.5
  },
  &quot;layoutDefinition&quot;: {
    &quot;extent&quot;: {
      &quot;xmin&quot;: 431902.5,
      &quot;ymin&quot;: 4313467.5,
      &quot;xmax&quot;: 445342.5,
      &quot;ymax&quot;: 4321147.5
    },
    &quot;tileLayout&quot;: {
      &quot;layoutCols&quot;: 7,
      &quot;layoutRows&quot;: 4,
      &quot;tileCols&quot;: 128,
      &quot;tileRows&quot;: 128
    }
  },
  &quot;bounds&quot;: {
    &quot;minKey&quot;: {
      &quot;col&quot;: 0,
      &quot;row&quot;: 0
    },
    &quot;maxKey&quot;: {
      &quot;col&quot;: 6,
      &quot;row&quot;: 3
    }
  },
  &quot;cellType&quot;: &quot;uint16&quot;,
  &quot;crs&quot;: &quot;+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs &quot;
}

</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">RasterFrames-Docs</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Astraea.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="../../_sources/Scala/Minis/creating-rasterframes-scala.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>